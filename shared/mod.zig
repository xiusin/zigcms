//! å…±äº«å±‚å…¥å£æ–‡ä»¶
//!
//! èŒè´£ï¼š
//! - æä¾›è·¨å±‚å…±äº«çš„å·¥å…·å‡½æ•°
//! - å®šä¹‰é€šç”¨ç±»å‹å’Œå¸¸é‡
//! - æä¾›åŸºç¡€åŸè¯­å’Œè¾…åŠ©åŠŸèƒ½
//! - ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶
//! - ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘

const std = @import("std");

// ============================================================================
// å¯¼å‡ºå…±äº«å±‚æ¨¡å—
// ============================================================================

/// å·¥å…·å‡½æ•°æ¨¡å—ï¼ˆå­—ç¬¦ä¸²ã€JWTã€åŠ å¯†ç­‰ï¼‰
pub const utils = @import("utils/mod.zig");

/// åŸºç¡€åŸè¯­æ¨¡å—ï¼ˆå…¨å±€å˜é‡ã€å®¹å™¨ã€æ³¨å†Œè¡¨ï¼‰
pub const primitives = @import("primitives/mod.zig");

/// é€šç”¨ç±»å‹å®šä¹‰ï¼ˆåˆ†é¡µã€ç»“æœç±»å‹ç­‰ï¼‰
pub const types = @import("types/mod.zig");

/// ç»Ÿä¸€é”™è¯¯å¤„ç†æ¨¡å—
pub const errors = @import("errors/mod.zig");

// ============================================================================
// ä¾¿æ·è®¿é—®ï¼ˆå‘åå…¼å®¹ï¼‰
// ============================================================================

/// å…¨å±€å˜é‡ç®¡ç†ï¼ˆå‘åå…¼å®¹ï¼‰
pub const global = primitives.global;

/// æ—¥å¿—è®°å½•å™¨ï¼ˆå‘åå…¼å®¹ï¼‰
pub const logger = primitives.logger;

// ============================================================================
// å…±äº«å±‚é…ç½®
// ============================================================================

/// å…±äº«å±‚é…ç½®
pub const SharedConfig = struct {
    /// æ—¥å¿—çº§åˆ«
    log_level: LogLevel = .Info,
    /// æ˜¯å¦å¯ç”¨è°ƒè¯•æ¨¡å¼
    debug_mode: bool = false,

    pub const LogLevel = enum {
        Debug,
        Info,
        Warn,
        Error,
    };
};

// ============================================================================
// åˆå§‹åŒ–å’Œæ¸…ç†
// ============================================================================

/// å…±äº«å±‚åˆå§‹åŒ–å‡½æ•°
pub fn init(allocator: std.mem.Allocator, config: SharedConfig) !void {
    _ = config;

    // åˆå§‹åŒ–å…¨å±€æ¨¡å—ï¼ˆåŒ…æ‹¬æ•°æ®åº“è¿æ¥å’Œæ—¥å¿—å™¨ï¼‰
    global.init(allocator);
    std.debug.print("âœ… å…±äº«å±‚åˆå§‹åŒ–å®Œæˆ\n", .{});

    // åˆå§‹åŒ–å„ä¸ªå­æ¨¡å—
    _ = utils;
    _ = types;
    _ = errors;
}

/// å…±äº«å±‚æ¸…ç†å‡½æ•°
pub fn deinit() void {
    std.debug.print("ğŸ‘‹ å…±äº«å±‚å·²æ¸…ç†\n", .{});
    global.deinit();
}
